# Architecture Diagrams & Visual Models

**Project:** RKH's Photo Order Management System  
**Document Type:** Visual System Design  
**Date:** January 6, 2025

---

## 1. System Context Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           EXTERNAL ENVIRONMENT                               │
│                                                                              │
│  ┌──────────────┐        ┌──────────────┐         ┌────────────────┐       │
│  │   Marketing  │        │   PMR System │         │  Runware AI    │       │
│  │     Users    │        │  (Internal)  │         │  (Cloud)       │       │
│  │              │        │              │         │                │       │
│  │ - Upload     │        │ - Event IDs  │         │ - Google       │       │
│  │ - Process    │        │ - Customer   │         │   Gemini 2.5   │       │
│  │ - Monitor    │        │   Data       │         │ - Image AI     │       │
│  └──────┬───────┘        └──────┬───────┘         └────────┬───────┘       │
│         │                       │                          │               │
│         │ Uses                  │ Integrates              │ Consumes      │
│         ▼                       ▼                          ▼               │
│  ┌────────────────────────────────────────────────────────────────┐        │
│  │                                                                 │        │
│  │        RKH'S PHOTO ORDER MANAGEMENT SYSTEM                     │        │
│  │                                                                 │        │
│  │  ┌─────────────────────────────────────────────────────────┐   │        │
│  │  │         Desktop Application (Electron)                  │   │        │
│  │  │  - Order Management                                     │   │        │
│  │  │  - Image Processing                                     │   │        │
│  │  │  - Event ID Management                                  │   │        │
│  │  │  - Analytics Dashboard                                  │   │        │
│  │  └─────────────────────────────────────────────────────────┘   │        │
│  │                                                                 │        │
│  │  ┌─────────────────────────────────────────────────────────┐   │        │
│  │  │         Backend API Server (Node.js)                    │   │        │
│  │  │  - RESTful API                                          │   │        │
│  │  │  - WebSocket Communication                              │   │        │
│  │  │  - Business Logic                                       │   │        │
│  │  └─────────────────────────────────────────────────────────┘   │        │
│  │                                                                 │        │
│  │  ┌─────────────────────────────────────────────────────────┐   │        │
│  │  │         Data Layer                                      │   │        │
│  │  │  - SQLite (Desktop) / PostgreSQL (Enterprise)           │   │        │
│  │  │  - Redis Cache                                          │   │        │
│  │  └─────────────────────────────────────────────────────────┘   │        │
│  │                                                                 │        │
│  └─────────────────────────────────────────────────────────────────┘        │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

**Key:** 
- External actors interact with the system
- System integrates with PMR (internal) and Runware AI (cloud)
- Three-tier architecture: Presentation → Application → Data

---

## 2. Component Architecture Diagram

```
┌───────────────────────────────────────────────────────────────────────┐
│                      PRESENTATION TIER                                │
│                                                                       │
│  ┌─────────────────────────────────────────────────────────────────┐ │
│  │                  Electron Desktop App                           │ │
│  │                                                                 │ │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌──────────┐ │ │
│  │  │   Order    │  │   Event    │  │  Analytics │  │ Settings │ │ │
│  │  │    View    │  │    View    │  │    View    │  │   View   │ │ │
│  │  └─────┬──────┘  └─────┬──────┘  └─────┬──────┘  └────┬─────┘ │ │
│  │        │                │                │              │       │ │
│  │        └────────────────┴────────────────┴──────────────┘       │ │
│  │                               ▼                                 │ │
│  │  ┌──────────────────────────────────────────────────────────┐  │ │
│  │  │              IPC Communication Layer                     │  │ │
│  │  │         (Secure Bridge: Renderer ↔ Main)               │  │ │
│  │  └──────────────────────────────────────────────────────────┘  │ │
│  └─────────────────────────────────────────────────────────────────┘ │
└───────────────────────────────────────────────────────────────────────┘
                                  ▼
┌───────────────────────────────────────────────────────────────────────┐
│                       APPLICATION TIER                                │
│                                                                       │
│  ┌────────────────────┐  ┌───────────────────┐  ┌─────────────────┐ │
│  │   Order Service    │  │   AI Service      │  │  PMR Service    │ │
│  │                    │  │                   │  │                 │ │
│  │ - Create order     │  │ - Process image   │  │ - Upload file   │ │
│  │ - Update status    │  │ - Generate text   │  │ - Validate ID   │ │
│  │ - Queue jobs       │  │ - Batch process   │  │ - Sync metadata │ │
│  │ - Validate data    │  │ - Cache results   │  │ - Handle errors │ │
│  └──────────┬─────────┘  └─────────┬─────────┘  └────────┬────────┘ │
│             │                      │                     │          │
│  ┌──────────┴──────────────────────┴─────────────────────┴────────┐ │
│  │              Shared Business Logic Layer                       │ │
│  │  - Validation  - Error Handling  - Logging  - Caching         │ │
│  └─────────────────────────────────────────────────────────────────┘ │
└───────────────────────────────────────────────────────────────────────┘
                                  ▼
┌───────────────────────────────────────────────────────────────────────┐
│                      INTEGRATION TIER                                 │
│                                                                       │
│  ┌────────────────┐  ┌────────────────┐  ┌───────────────────────┐  │
│  │  Runware API   │  │  PMR REST API  │  │   File System         │  │
│  │   Connector    │  │   Connector    │  │   Manager             │  │
│  │                │  │                │  │                       │  │
│  │ - WebSocket    │  │ - HTTP Client  │  │ - Read/Write          │  │
│  │ - Retry logic  │  │ - Auth tokens  │  │ - Temp storage        │  │
│  │ - Queue mgmt   │  │ - Rate limit   │  │ - Cleanup             │  │
│  └────────┬───────┘  └───────┬────────┘  └──────────┬────────────┘  │
│           │                  │                      │               │
│           ▼                  ▼                      ▼               │
│  [Cloud AI Service]  [Internal PMR]       [Local/Network Storage]  │
└───────────────────────────────────────────────────────────────────────┘
                                  ▼
┌───────────────────────────────────────────────────────────────────────┐
│                         DATA TIER                                     │
│                                                                       │
│  ┌───────────────┐  ┌─────────────────┐  ┌──────────────────────┐   │
│  │    SQLite     │  │   PostgreSQL    │  │      Redis Cache     │   │
│  │   (Desktop)   │  │  (Enterprise)   │  │                      │   │
│  │               │  │                 │  │ - Session data       │   │
│  │ - Orders      │  │ - Orders        │  │ - AI responses       │   │
│  │ - Images      │  │ - Images        │  │ - Event cache        │   │
│  │ - Events      │  │ - Events        │  │ - PMR metadata       │   │
│  │ - Users       │  │ - Audit logs    │  │                      │   │
│  └───────────────┘  └─────────────────┘  └──────────────────────┘   │
└───────────────────────────────────────────────────────────────────────┘
```

---

## 3. Data Flow Diagram - Order Processing

```
┌──────────────┐
│              │
│  Marketing   │
│    User      │
│              │
└──────┬───────┘
       │ 1. Upload Images
       ▼
┌──────────────────────────────────────────────┐
│    Desktop Application (Electron)            │
│                                              │
│  ┌─────────────────────────────────────┐    │
│  │  2. Create Order                    │    │
│  │     - Generate Order ID             │    │
│  │     - Store images to temp dir      │    │
│  │     - Create order record in DB     │    │
│  └─────────────┬───────────────────────┘    │
│                ▼                             │
│  ┌─────────────────────────────────────┐    │
│  │  3. Validate Event ID               │    │
│  └─────────────┬───────────────────────┘    │
└────────────────┼──────────────────────────────┘
                 │ API Call
                 ▼
         ┌───────────────┐
         │   PMR System  │
         │               │
         │  4. Validate  │──────────┐
         │     Event     │          │ Response: Valid/Invalid
         └───────────────┘          │
                 ▲                  │
                 │                  ▼
┌────────────────┼────────────────────────────────┐
│                │                                │
│  ┌─────────────┴──────────────────────────┐    │
│  │  5. Process with AI                    │    │
│  │     - Read image files                 │    │
│  │     - Generate prompts                 │    │
│  │     - Call AI service                  │    │
│  └─────────────┬──────────────────────────┘    │
│                │ WebSocket Request              │
│                ▼                                │
│      ┌──────────────────┐                      │
│      │  Runware AI API  │                      │
│      │  (Google Gemini) │                      │
│      │                  │                      │
│      │  6. Image        │                      │
│      │     Analysis &   │                      │
│      │     Processing   │                      │
│      └─────────┬────────┘                      │
│                │ Response with metadata         │
│                ▼                                │
│  ┌─────────────────────────────────────────┐   │
│  │  7. Store AI Results                    │   │
│  │     - Update image metadata             │   │
│  │     - Save AI-generated content         │   │
│  └─────────────┬───────────────────────────┘   │
│                ▼                                │
│  ┌─────────────────────────────────────────┐   │
│  │  8. Upload to PMR                       │   │
│  │     - Transfer processed images         │   │
│  │     - Send metadata                     │   │
│  └─────────────┬───────────────────────────┘   │
│                │ REST API Call                  │
│                ▼                                │
│       ┌─────────────────┐                      │
│       │   PMR System    │                      │
│       │                 │                      │
│       │  9. Store Files │                      │
│       │     & Metadata  │                      │
│       └────────┬────────┘                      │
│                │ Response: URLs                 │
│                ▼                                │
│  ┌─────────────────────────────────────────┐   │
│  │  10. Finalize Order                     │   │
│  │      - Update order status              │   │
│  │      - Store PMR URLs                   │   │
│  │      - Generate report                  │   │
│  │      - Notify user                      │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│    Desktop Application (Backend)                │
└─────────────────────────────────────────────────┘
```

**Processing Time:** 4 hours (manual) → 12 minutes (automated)

---

## 4. Deployment Topology

### 4.1 Desktop Deployment (Phase 1-2)

```
┌─────────────────────────────────────────────────────────────┐
│                     User's Machine                          │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │         Electron Application                        │   │
│  │  ┌─────────────────────────────────────────────┐    │   │
│  │  │         Frontend (Renderer Process)         │    │   │
│  │  │         - HTML/CSS/JavaScript               │    │   │
│  │  └─────────────────────────────────────────────┘    │   │
│  │                       ▲ IPC                         │   │
│  │  ┌─────────────────────────────────────────────┐    │   │
│  │  │         Backend (Main Process)              │    │   │
│  │  │         - Node.js Runtime                   │    │   │
│  │  │         - Express API Server                │    │   │
│  │  │         - Business Logic                    │    │   │
│  │  └─────────────────────────────────────────────┘    │   │
│  │                       ▲                             │   │
│  │  ┌─────────────────────────────────────────────┐    │   │
│  │  │         Local Database                      │    │   │
│  │  │         - SQLite (orders, images, cache)    │    │   │
│  │  └─────────────────────────────────────────────┘    │   │
│  └─────────────────────────────────────────────────────┘   │
│                           │                                │
│                           │ Network                        │
└───────────────────────────┼─────────────────────────────────┘
                            │
      ┌─────────────────────┼─────────────────────────┐
      │                     ▼                         │
      │  ┌────────────────────────────────────┐      │
      │  │      Runware AI API (Cloud)        │      │
      │  │  - wss://ws-api.runware.ai/v1      │      │
      │  │  - Google Gemini Flash Image 2.5   │      │
      │  └────────────────────────────────────┘      │
      │                                               │
      │  ┌────────────────────────────────────┐      │
      │  │    PMR REST API (Internal)         │      │
      │  │  - https://pmr.rkh.internal/api    │      │
      │  │  - Event validation                │      │
      │  │  - File upload                     │      │
      │  └────────────────────────────────────┘      │
      │                                               │
      │          External Services                    │
      └───────────────────────────────────────────────┘
```

### 4.2 Enterprise Deployment (Phase 3-4)

```
┌──────────────────────────────────────────────────────────────────┐
│                    Corporate Network                             │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │          Load Balancer (Nginx)                             │ │
│  │          - SSL Termination                                 │ │
│  │          - Health Checks                                   │ │
│  └─────────────────────┬──────────────────────────────────────┘ │
│                        │                                         │
│      ┌─────────────────┼─────────────────────┐                  │
│      │                 │                     │                  │
│      ▼                 ▼                     ▼                  │
│  ┌────────┐       ┌────────┐           ┌────────┐              │
│  │  API   │       │  API   │           │  API   │              │
│  │ Server │       │ Server │           │ Server │              │
│  │   #1   │       │   #2   │           │   #3   │              │
│  └───┬────┘       └───┬────┘           └───┬────┘              │
│      │                │                    │                   │
│      └────────────────┼────────────────────┘                   │
│                       │                                         │
│                       ▼                                         │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │              PostgreSQL Cluster                          │  │
│  │  ┌─────────────┐         ┌─────────────┐                │  │
│  │  │   Primary   │ ──────→ │   Replica   │                │  │
│  │  │   Database  │         │   Database  │                │  │
│  │  └─────────────┘         └─────────────┘                │  │
│  └──────────────────────────────────────────────────────────┘  │
│                       │                                         │
│                       ▼                                         │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │              Redis Cache Cluster                         │  │
│  │  - Session Management                                    │  │
│  │  - Response Caching                                      │  │
│  │  - Rate Limiting                                         │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
                            │
        ┌───────────────────┼───────────────────┐
        │                   │                   │
        ▼                   ▼                   ▼
┌────────────────┐  ┌────────────────┐  ┌─────────────────┐
│  User Desktop  │  │  User Desktop  │  │  User Desktop   │
│  (Electron)    │  │  (Electron)    │  │  (Electron)     │
│                │  │                │  │                 │
│  - Connects to │  │  - Connects to │  │  - Connects to  │
│    API Server  │  │    API Server  │  │    API Server   │
└────────────────┘  └────────────────┘  └─────────────────┘

          200+ Concurrent Users
```

---

## 5. Security Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                      SECURITY LAYERS                            │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Layer 1: Authentication & Authorization                 │  │
│  │                                                          │  │
│  │  ┌────────────┐  ┌─────────────┐  ┌──────────────────┐  │  │
│  │  │   OAuth    │  │    JWT      │  │   RBAC Roles     │  │  │
│  │  │   2.0      │→ │   Tokens    │→ │  Admin/Manager/  │  │  │
│  │  │            │  │             │  │  User/Viewer     │  │  │
│  │  └────────────┘  └─────────────┘  └──────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                           ▼                                    │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Layer 2: Transport Security                            │  │
│  │                                                          │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │   TLS 1.3 Encryption                               │  │  │
│  │  │   - All network traffic encrypted                  │  │  │
│  │  │   - Certificate validation                         │  │  │
│  │  │   - Perfect forward secrecy                        │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                           ▼                                    │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Layer 3: Application Security                          │  │
│  │                                                          │  │
│  │  ┌──────────────┐  ┌─────────────┐  ┌──────────────┐   │  │
│  │  │   Input      │  │  Rate       │  │   CORS       │   │  │
│  │  │  Validation  │  │  Limiting   │  │  Headers     │   │  │
│  │  │  & Sanitize  │  │  (100/min)  │  │  (Strict)    │   │  │
│  │  └──────────────┘  └─────────────┘  └──────────────┘   │  │
│  └──────────────────────────────────────────────────────────┘  │
│                           ▼                                    │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Layer 4: Data Security                                 │  │
│  │                                                          │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │   Encryption at Rest (AES-256)                     │  │  │
│  │  │   - Database encryption                            │  │  │
│  │  │   - API key storage in OS keychain                 │  │  │
│  │  │   - Secure file permissions                        │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                           ▼                                    │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Layer 5: Audit & Monitoring                            │  │
│  │                                                          │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │   Comprehensive Logging                            │  │  │
│  │  │   - All authentication attempts                    │  │  │
│  │  │   - Authorization violations                       │  │  │
│  │  │   - Data access patterns                           │  │  │
│  │  │   - System anomalies                               │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 6. High-Availability Architecture (Future)

```
┌──────────────────────────────────────────────────────────────┐
│                      REGION: EU-WEST                         │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │    Availability Zone 1                               │   │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐     │   │
│  │  │  API #1    │  │   DB       │  │  Redis #1  │     │   │
│  │  │  (Active)  │  │  Primary   │  │  (Master)  │     │   │
│  │  └────────────┘  └────────────┘  └────────────┘     │   │
│  └──────────────────────────────────────────────────────┘   │
│                            │                                │
│                            │ Replication                    │
│                            ▼                                │
│  ┌──────────────────────────────────────────────────────┐   │
│  │    Availability Zone 2                               │   │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐     │   │
│  │  │  API #2    │  │   DB       │  │  Redis #2  │     │   │
│  │  │ (Standby)  │  │  Replica   │  │  (Slave)   │     │   │
│  │  └────────────┘  └────────────┘  └────────────┘     │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
│  Target Uptime: 99.95% (4.4 hours downtime/year)            │
└──────────────────────────────────────────────────────────────┘
```

---

## 7. Key Metrics Dashboard Layout

```
┌────────────────────────────────────────────────────────────────────┐
│                  ANALYTICS DASHBOARD                               │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐   │
│  │  Orders Today   │  │  Processing     │  │  Error Rate     │   │
│  │       24        │  │  Time (Avg)     │  │      1.2%       │   │
│  │   ↑ 20% vs yest │  │   11 min        │  │  ↓ 0.5% vs yest │   │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘   │
│                                                                    │
│  ┌──────────────────────────────────────────────────────────────┐ │
│  │  Processing Time Trend (Last 7 Days)                        │ │
│  │                                                              │ │
│  │   15min ┤                                                   │ │
│  │         │                                                   │ │
│  │   12min ├─────────────────────────────────────────────────  │ │
│  │         │                                                   │ │
│  │    9min ┤                                                   │ │
│  │         └──┬──┬──┬──┬──┬──┬──                              │ │
│  │           Mon Tue Wed Thu Fri Sat Sun                       │ │
│  └──────────────────────────────────────────────────────────────┘ │
│                                                                    │
│  ┌───────────────────────────┐  ┌────────────────────────────┐   │
│  │  Top Events (Orders)      │  │  System Health             │   │
│  │  1. EVT-2025-001 (45)     │  │  ● API Server:   Healthy   │   │
│  │  2. EVT-2025-002 (38)     │  │  ● Database:     Healthy   │   │
│  │  3. EVT-2025-003 (29)     │  │  ● PMR:          Healthy   │   │
│  │  4. EVT-2025-004 (21)     │  │  ● AI Service:   Healthy   │   │
│  │  5. EVT-2025-005 (18)     │  │  ● Uptime:       99.98%    │   │
│  └───────────────────────────┘  └────────────────────────────┘   │
└────────────────────────────────────────────────────────────────────┘
```

---

## 8. Technology Stack Visual

```
┌─────────────────────────────────────────────────────────────────┐
│                    TECHNOLOGY STACK                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  FRONTEND TIER                                                  │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐       │
│  │ Electron │  │  HTML5   │  │   CSS3   │  │   JS     │       │
│  │   28+    │  │          │  │          │  │  ES6+    │       │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘       │
│                                                                 │
│  ─────────────────────────────────────────────────────────────  │
│                                                                 │
│  BACKEND TIER                                                   │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐       │
│  │ Node.js  │  │ Express  │  │ Winston  │  │  Axios   │       │
│  │  20 LTS  │  │  4.18+   │  │   3.x    │  │   1.x    │       │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘       │
│                                                                 │
│  ─────────────────────────────────────────────────────────────  │
│                                                                 │
│  DATA TIER                                                      │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐                     │
│  │  SQLite  │  │PostgreSQL│  │  Redis   │                     │
│  │  3.44+   │  │   15+    │  │   7.x    │                     │
│  └──────────┘  └──────────┘  └──────────┘                     │
│                                                                 │
│  ─────────────────────────────────────────────────────────────  │
│                                                                 │
│  INTEGRATION TIER                                               │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐                     │
│  │ Runware  │  │   PMR    │  │  Sharp   │                     │
│  │   AI     │  │   API    │  │  Image   │                     │
│  └──────────┘  └──────────┘  └──────────┘                     │
│                                                                 │
│  ─────────────────────────────────────────────────────────────  │
│                                                                 │
│  DEVOPS TIER                                                    │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐       │
│  │   Git    │  │  Docker  │  │   Jest   │  │  GitHub  │       │
│  │          │  │          │  │  Tests   │  │  Actions │       │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘       │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

**Note:** These diagrams represent the current and future state of the system architecture. ASCII art format chosen for maximum compatibility with all document viewers and version control systems.

**Document Owner:** [Your Name], Enterprise Architect  
**Last Updated:** January 6, 2025
